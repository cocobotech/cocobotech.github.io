<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>COCOBO-PLOT · Geometry Nodes 菜单对比（服务器 JSON 版）</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root {
    --bg: #1e1e1e;
    --panel: #2d2d2d;
    --border: #444;
    --text: #e0e0e0;
    --text-dim: #aaa;
    --new: #ff6b6b;
    --hover: #3a3a3a;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { margin:0; height:100vh; background:var(--bg); color:var(--text); font-family:'Segoe UI',sans-serif; overflow:hidden; display:flex; flex-direction:column; }
  .header { padding:16px; background:#2a2a2a; border-bottom:1px solid var(--border); text-align:center; font-size:1.4rem; font-weight:bold; color:#58a6ff; }
  .selector-bar { padding:12px; background:#363636; display:flex; gap:20px; align-items:center; justify-content:center; flex-wrap:wrap; }
  .selector-bar select { padding:10px; background:#1e1e1e; color:white; border:1px solid #555; border-radius:6px; min-width:280px; font-size:1rem; }
  .container { display:flex; flex:1; overflow:hidden; }
  .side { width:50%; overflow-y:auto; background:var(--panel); border-right:1px solid var(--border); position:relative; }
  .side:last-child { border-right:none; }
  .side h2 { padding:16px; margin:0; background:#363636; text-align:center; font-size:1.2rem; border-bottom:1px solid var(--border); position:sticky; top:0; z-index:10; }
  .toolbar { padding:10px 12px; background:#363636; display:flex; align-items:center; gap:12px; position:sticky; top:53px; z-index:9; }
  .toolbar input[type="text"] { flex:1; min-width:200px; padding:9px; background:#1e1e1e; border:1px solid #555; border-radius:6px; color:white; }
  .toolbar label { color:white; white-space:nowrap; cursor:pointer; user-select:none; }
  .toolbar input[type="checkbox"] { transform:scale(1.3); accent-color:var(--new); cursor:pointer; }
  .tree { padding:8px 0; }
  .cat { margin:6px 12px; border:1px solid #555; border-radius:8px; overflow:hidden; background:#2f2f2f; }
  .cat-head { padding:11px 16px; background:#3a3a3a; cursor:pointer; user-select:none; font-weight:bold; display:flex; align-items:center; gap:10px; transition:background 0.2s; }
  .cat-head:hover { background:#444; }
  .cat-head::before { content:">"; font-size:0.9rem; transition:transform 0.25s; color:#aaa; }
  .cat-head:not(.collapsed)::before { transform:rotate(90deg); }
  .items { padding:4px 0; background:#2a2a2a; }
  .item { padding:8px 32px; cursor:default; font-size:0.95rem; transition:background 0.2s; display:flex; align-items:center; gap:10px; }
  .item:hover { background:var(--hover); }
  .item.new { color:var(--new); font-weight:bold; }
  .item.new::after { content:"NEW"; background:var(--new); color:white; font-size:0.65rem; padding:2px 6px; border-radius:4px; margin-left:8px; }
  .item.hidden { display:none !important; }
  .collapsed + .items { display:none; }
  .footer { padding:12px; background:#2a2a2a; border-top:1px solid var(--border); text-align:center; font-size:0.9rem; color:#888; }
  .loading { text-align:center; padding:40px; color:var(--text-dim); }
</style>
</head>
<body>

<div class="header">COCOBO Geometry Nodes 菜单对比（GitHub JSON 版）</div>

<div class="selector-bar">
  <div>
    <strong>左侧版本：</strong>
    <select id="leftSelect">
      <option value="">— 加载中... —</option>
    </select>
  </div>
  <div>
    <strong>右侧版本：</strong>
    <select id="rightSelect">
      <option value="">— 加载中... —</option>
    </select>
  </div>
</div>

<div class="container">
  <!-- 左侧 -->
  <div class="side">
    <h2 id="leftTitle">左侧版本</h2>
    <div class="toolbar"><input type="text" id="sLeft" placeholder="搜索节点..."></div>
    <div class="tree" id="leftTree">
      <div class="loading">选择左侧 JSON 文件加载菜单...</div>
    </div>
  </div>

  <!-- 右侧 -->
  <div class="side">
    <h2 id="rightTitle">右侧版本</h2>
    <div class="toolbar">
      <input type="text" id="sRight" placeholder="搜索节点...">
      <label><input type="checkbox" id="onlyNew"> 只看 NEW</label>
    </div>
    <div class="tree" id="rightTree">
      <div class="loading">选择右侧 JSON 文件加载菜单...</div>
    </div>
  </div>
</div>

<div class="footer">COCOBO 2025 ·</div>

<script>
    

const BASE_URL = 'https://raw.githubusercontent.com/cocobotech/cocobotech.github.io/main/3D/blender/json/';
const DIR_URL  = 'https://api.github.com/repos/cocobotech/cocobotech.github.io/contents/3D/blender/json?ref=main';

// 获取目录下所有 .json 文件
async function fetchJsonFiles() {
  try {
    const res = await fetch(DIR_URL);
    const data = await res.json();
    return data.filter(item => item.name.endsWith('.json')).map(item => item.name);
  } catch (err) {
    console.error('获取文件列表失败:', err);
    return []; // 或 fallback 列表
  }
}

// 加载单个 JSON 文件
async function loadJson(filename) {
  try {
    const res = await fetch(BASE_URL + filename);
    if (!res.ok) throw new Error('文件加载失败');
    return await res.json();
  } catch (err) {
    console.error('JSON 加载失败:', err);
    return null;
  }
}

// 生成树形菜单 HTML
function generateTree(data, highlightNew = false) {
  if (!data || !data.categories) return '<div class="loading">无效 JSON 数据</div>';

  let html = '';
  data.categories.forEach(cat => {
    html += `<div class="cat">
      <div class="cat-head">${cat.name || cat.id}</div>
      <div class="items">`;
    (cat.items || []).forEach(item => {
      html += `<div class="item">${item}</div>`;
    });
    html += '</div></div>';
  });
  return html;
}

// 更新侧边栏
async function updateSide(select, treeId, titleId, isRight = false) {
  const filename = select.value;
  if (!filename) {
    document.getElementById(treeId).innerHTML = '<div class="loading">选择 JSON 文件</div>';
    document.getElementById(titleId).textContent = isRight ? "右侧版本" : "左侧版本";
    return;
  }

  const data = await loadJson(filename);
  document.getElementById(titleId).textContent = filename;

  if (data) {
    document.getElementById(treeId).innerHTML = generateTree(data);
    if (isRight) updateNewHighlight(treeId); // 右侧高亮 NEW
  } else {
    document.getElementById(treeId).innerHTML = '<div class="loading">加载失败</div>';
  }
}

// 只看 NEW（右侧）
function updateNewHighlight(treeId) {
  const onlyNew = document.getElementById('onlyNew').checked;
  document.querySelectorAll(`#${treeId} .item`).forEach(item => {
    if (onlyNew) {
      item.style.display = item.classList.contains('new') ? 'flex' : 'none';
    } else {
      item.style.display = 'flex';
    }
  });
}

// 初始化下拉框
async function initSelectors() {
  const files = await fetchJsonFiles();
  const leftSel = document.getElementById('leftSelect');
  const rightSel = document.getElementById('rightSelect');

  files.forEach(f => {
    const optL = document.createElement('option');
    optL.value = f;
    optL.textContent = f;
    leftSel.appendChild(optL);

    const optR = document.createElement('option');
    optR.value = f;
    optR.textContent = f;
    rightSel.appendChild(optR);
  });

  if (files.length === 0) {
    leftSel.innerHTML = '<option>目录中无 .json 文件</option>';
    rightSel.innerHTML = '<option>目录中无 .json 文件</option>';
  }

  leftSel.onchange = () => updateSide(leftSel, 'leftTree', 'leftTitle');
  rightSel.onchange = () => updateSide(rightSel, 'rightTree', 'rightTitle', true);

  // 只看 NEW 绑定
  document.getElementById('onlyNew').onchange = () => updateNewHighlight('rightTree');

  // 搜索绑定
  document.getElementById('sLeft').oninput = filterTree.bind(null, 'leftTree');
  document.getElementById('sRight').oninput = filterTree.bind(null, 'rightTree');
}

// 搜索过滤
function filterTree(treeId, query) {
  query = query.toLowerCase();
  document.querySelectorAll(`#${treeId} .item`).forEach(item => {
    item.style.display = item.textContent.toLowerCase().includes(query) ? 'flex' : 'none';
  });
}

// 启动
initSelectors();
</script>
</body>
</html>
