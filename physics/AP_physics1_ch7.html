<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AP Physics 1 - Oscillations</title>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+SC:wght@300;500;700&display=swap');

:root {
  --primary-color: #4f46e5;
  --secondary-color: #10b981;
  --bg-light: #f3f4f6;
  --text-dark: #1f2937;
}

body { 
  font-family:'Inter','Noto Sans SC','Inter',sans-serif; 
  background-color: var(--bg-light); 
  color: var(--text-dark); 
  line-height: 1.6;
  margin:0; padding:0;
}
.container-app { 
  max-width: 1200px; 
  margin:10px auto; 
  padding:10px; 
  background-color:rgba(244, 244, 247, 0.863); 
  border-radius:24px; 
  box-shadow:0 10px 30px rgba(26, 122, 177, 0.384);
}

.container-header {
  background: white;
  border-radius: 25px;
  padding: 10px;
  margin-bottom: 5px;
  box-shadow: 0 15px 10px rgba(0,0,0,0.3);
  text-align: center;
  position: relative;
  overflow: hidden;
}
        
h1 { 
  font-size: 2.5rem;
  color: var(--primary-color); 
  font-weight:700; 
  text-align:center; 
  margin: 0;
}
h2 { 
  font-size:1.5rem; 
  font-weight:600; 
  color:var(--text-dark); 
  border-left:5px solid var(--primary-color); 
  padding-left:10px; 
  margin-bottom:20px;
}

.text2xl { 
  color: var(--primary-color); 
  font-weight:900; 
  text-align:left; 
  padding-bottom:10px;
}
.concept-card { 
  background:rgb(242, 247, 248); 
  border-radius:16px; 
  padding:20px; 
  box-shadow:0 4px 15px rgba(5, 126, 207, 0.658); 
  transition:transform 0.3s ease, box-shadow 0.3s ease;
}
.concept-card:hover { 
  transform: translateY(-5px); 
  box-shadow:0 8px 25px rgba(0,0,0,0.15);
}
.formula { 
  font-family:'Times New Roman', serif; 
  font-size:1.2rem; 
  font-weight:bold; 
  color: var(--secondary-color); 
  padding:10px 0; 
  text-align:center; 
  border-top:1px solid #e5e7eb; 
  margin-top:15px;
}
.katex { color: var(--secondary-color) !important; }

/* Canvas Styles */
canvas { 
  background-color:#eef2ff; 
  border-radius:12px; 
  cursor:pointer;
  display: block;
}
#simulationCanvas, #energyCanvas, #pendulumCanvas, #phaseCanvas { 
  border:2px solid var(--primary-color); 
}

/* Layout for Spring Visuals (Side by Side) */
.spring-visuals {
    display: flex;
    gap: 10px;
    justify-content: center;
    align-items: flex-start;
    flex-wrap: wrap; /* Allow wrapping on small screens */
}

.control-group label { font-weight:500; color:var(--text-dark);}
.control-group input[type="range"] { width:100%; }
.btn-simulate { 
  background-color: var(--primary-color); 
  color:white; 
  padding:10px 20px; 
  border-radius:12px; 
  font-weight:600; 
  transition: background-color 0.3s;
  border:none;
  cursor:pointer;
}
.btn-simulate:hover:not(:disabled) { background-color:#6366f1; }
.btn-simulate:disabled { background-color:#9ca3af; cursor:not-allowed; }

.results-box { 
  background-color:#f0fdf4; 
  border:1px solid var(--secondary-color); 
  border-radius:12px; 
  padding:15px;
  text-align:center;
}
.results-box strong { color: var(--secondary-color); }

.grid-1 { display: grid; grid-template-columns: repeat(1,1fr); gap: 1rem; }
.grid-2 { display: grid; grid-template-columns: repeat(2,1fr); gap: 1rem; }
.grid-3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 1rem; }
.grid-2a { display: grid; grid-template-columns: 250px 1fr; gap: 1rem; } /* Adjusted width for controls */

.mb-4 { margin-bottom: 1rem; }
.mb-6 { margin-bottom: 1.5rem; }
.my-8 { margin-top: 2rem; margin-bottom: 2rem; }
.my-10 { margin-top: 2.5rem; margin-bottom: 2.5rem; }
.p-4 { padding: 1rem; }
.mb-2 { margin-bottom: 0.5rem; }
.mb-3 { margin-bottom: 0.75rem; }
.w-full { width: 100%; }
.mt-1 { margin-top: 0.25rem; }
.mt-2 { margin-top: 0.5rem; }

.list-disc { list-style-type: disc; }
.list-inside { list-style-position: inside; }
.text-sm { font-size: 0.875rem; }
.text-xl { font-size: 1.25rem; }
.text-lg { font-size: 1.125rem; }
.font-bold { font-weight: 700; }
.font-semibold { font-weight: 600; }
.text-center { text-align: center; }
.text-gray-500 { color: #6b7280; }
</style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>

</head>
<body>
<div class="container-app">
    <div class="container-header">
        <h1>COCOBO-TECH AP Physics 1</h1>
        <p style="text-align: center;text-decoration: underline;">CH7: Oscillations</p>
    </div>

<!-- Core Concept Cards (Unchanged) -->
<div class="my-8">
    <h2>Core Concepts and Formulas</h2>
    
    <!-- Simple Harmonic Motion & Restoring Force -->
    <div class="grid-2 mb-4">
        <!-- SHM Definition -->
        <div class="concept-card">
            <h3 class="text2xl">1. Simple Harmonic Motion (SHM)</h3>
            <p>Periodic motion where restoring force is proportional to displacement from equilibrium.</p>
            <ul class="list-disc list-inside mt-2 text-sm text-gray-500">
                <li>Position: x(t) = A cos(œât + œÜ)</li>
                <li>A = amplitude, œâ = angular frequency, œÜ = phase constant</li>
                <li>Motion repeats with constant period T</li>
            </ul>
            <div class="formula">\( x(t) = A\cos(\omega t + \phi) \)</div>
        </div>

        <!-- Hooke's Law -->
        <div class="concept-card">
            <h3 class="text2xl">2. Hooke's Law & Restoring Force</h3>
            <p>Spring force is proportional to displacement, always directed toward equilibrium.</p>
            <ul class="list-disc list-inside mt-2 text-sm text-gray-500">
                <li>k = spring constant (N/m)</li>
                <li>Negative sign: force opposes displacement</li>
                <li>Larger k = stiffer spring</li>
            </ul>
            <div class="formula">\( F = -kx \)</div>
        </div>
    </div>

    <!-- Period & Frequency -->
    <div class="grid-3 mb-4">
        <!-- Period -->
        <div class="concept-card">
            <h3 class="text2xl">3. Period (T)</h3>
            <p>Time for one complete oscillation.</p>
            <ul class="list-disc list-inside mt-2 text-sm text-gray-500">
                <li>Unit: seconds (s)</li>
                <li>Independent of amplitude</li>
                <li>Larger mass or smaller k ‚Üí longer period</li>
            </ul>
            <div class="formula">\( T = 2\pi\sqrt{\frac{m}{k}} \)</div>
        </div>

        <!-- Frequency -->
        <div class="concept-card">
            <h3 class="text2xl">4. Frequency (f)</h3>
            <p>Number of oscillations per second.</p>
            <ul class="list-disc list-inside mt-2 text-sm text-gray-500">
                <li>Unit: Hertz (Hz) = 1/s</li>
                <li>f = 1/T</li>
                <li>Higher frequency = faster oscillation</li>
            </ul>
            <div class="formula">\( f = \frac{1}{T} = \frac{1}{2\pi}\sqrt{\frac{k}{m}} \)</div>
        </div>

        <!-- Angular Frequency -->
        <div class="concept-card">
            <h3 class="text2xl">5. Angular Frequency (œâ)</h3>
            <p>Rate of change of phase angle.</p>
            <ul class="list-disc list-inside mt-2 text-sm text-gray-500">
                <li>Unit: rad/s</li>
                <li>œâ = 2œÄf</li>
                <li>Determines oscillation speed</li>
            </ul>
            <div class="formula">\( \omega = 2\pi f = \sqrt{\frac{k}{m}} \)</div>
        </div>
    </div>

    <!-- Velocity & Acceleration -->
    <div class="grid-2 mb-4">
        <div class="concept-card">
            <h3 class="text2xl">6. Velocity in SHM</h3>
            <p>Maximum at equilibrium (x=0), zero at maximum displacement.</p>
            <ul class="list-disc list-inside mt-2 text-sm text-gray-500">
                <li>v(t) = derivative of position</li>
                <li>v_max = Aœâ at equilibrium</li>
                <li>90¬∞ out of phase with position</li>
            </ul>
            <div class="formula">\( v(t) = -A\omega\sin(\omega t + \phi) \)</div>
            <div class="formula">\( v_\text{max} = A\omega \)</div>
        </div>

        <div class="concept-card">
            <h3 class="text2xl">7. Acceleration in SHM</h3>
            <p>Maximum at extremes, zero at equilibrium. Always toward center.</p>
            <ul class="list-disc list-inside mt-2 text-sm text-gray-500">
                <li>a(t) = derivative of velocity</li>
                <li>a = -œâ¬≤x (proportional to displacement)</li>
                <li>180¬∞ out of phase with position</li>
            </ul>
            <div class="formula">\( a(t) = -A\omega^2\cos(\omega t + \phi) = -\omega^2 x \)</div>
            <div class="formula">\( a_\text{max} = A\omega^2 = \frac{k}{m}A \)</div>
        </div>
    </div>

    <!-- Energy in SHM -->
    <div class="grid-3 mb-4">
        <div class="concept-card">
            <h3 class="text2xl">8. Elastic Potential Energy</h3>
            <p>Energy stored in spring when compressed or stretched.</p>
            <ul class="list-disc list-inside mt-2 text-sm text-gray-500">
                <li>Maximum at extreme positions</li>
                <li>Zero at equilibrium</li>
                <li>Parabolic relationship with x</li>
            </ul>
            <div class="formula">\( U_s = \frac{1}{2}kx^2 \)</div>
        </div>

        <div class="concept-card">
            <h3 class="text2xl">9. Kinetic Energy in SHM</h3>
            <p>Energy of motion during oscillation.</p>
            <ul class="list-disc list-inside mt-2 text-sm text-gray-500">
                <li>Maximum at equilibrium</li>
                <li>Zero at extreme positions</li>
                <li>Converts to/from potential energy</li>
            </ul>
            <div class="formula">\( Ke = \frac{1}{2}mv^2 \)</div>
        </div>

        <div class="concept-card">
            <h3 class="text2xl">10. Total Mechanical Energy</h3>
            <p>Sum of kinetic and potential energy, conserved in ideal SHM.</p>
            <ul class="list-disc list-inside mt-2 text-sm text-gray-500">
                <li>Constant throughout motion</li>
                <li>E = ¬ΩkA¬≤ (depends on amplitude)</li>
                <li>Energy oscillates between KE and PE</li>
            </ul>

            <svg width="180" height="80" viewBox="0 0 180 80">
                <path d="M10,70 Q90,-30 170,70" stroke="#10b981" fill="none" stroke-width="2"/>
                <path d="M10,70 Q90,170 170,70" stroke="transparent" fill="none"/>
                <path d="M10,10 Q90,110 170,10" stroke="#4f46e5" fill="none" stroke-width="2" stroke-dasharray="4,2"/>
                <text x="85" y="69" font-size="10" fill="#4f46e5">Us (max at A)</text>
                <text x="85" y="18" font-size="10" fill="#10b981">K (max at eq)</text>
            </svg>

            <div class="formula">\( E = K_e + U_s = \frac{1}{2}kA^2= \frac{1}{2}mv_\text{max}^2 \)</div>
        </div>
    </div>

    <!-- Simple Pendulum -->
    <div class="grid-1 mb-4">
        <div class="concept-card">
            <h3 class="text2xl">11. Simple Pendulum <span style="background-color: #f0ec09;">(Small Angles)</span></h3>
            <p>Mass on string undergoes SHM for small angular displacements <span style="background-color: #f0ec09;">(Œ∏ < 15¬∞)</span>.</p>
            <ul class="list-disc list-inside mt-2 text-sm text-gray-500">
                <li>L = length of pendulum, g = gravitational acceleration</li>
                <li>Period <span style="background-color: #f0ec09;">independent of mass and amplitude (for small angles)</span></li>
                <li>Restoring force:<span style="background-color: #7bd16a;">  F = -mg sinŒ∏ ‚âà -mgŒ∏ (for small Œ∏)</span></li>
            </ul>
            <div class="formula">\( T = 2\pi\sqrt{\frac{L}{g}} \)</div>
        </div>
    </div>
</div>

<!-- Interactive Mass-Spring Simulation -->
<div class="my-8">
    <h2>Interactive Mass-Spring Oscillator</h2>
    
    <div class="grid-2a">
        <!-- Controls -->
        <div class="concept-card">
            <h3 class="text2xl mb-3">Controls</h3>
            
            <div class="control-group mb-3">
                <label>Mass (kg): <span id="massValue">1.0</span></label>
                <input type="range" id="massSlider" min="0.5" max="5" value="1" step="0.1">
            </div>
            
            <div class="control-group mb-3">
                <label>Spring Constant k (N/m): <span id="springValue">20</span></label>
                <input type="range" id="springSlider" min="5" max="50" value="20" step="5">
            </div>
            
            <div class="control-group mb-3">
                <label>Amplitude (m): <span id="amplitudeValue">2.0</span></label>
                <input type="range" id="amplitudeSlider" min="0.5" max="3" value="2" step="0.1">
            </div>
            
            <button class="btn-simulate w-full" onclick="startOscillation()">Start Oscillation</button>
            <button class="btn-simulate w-full mt-2" onclick="stopOscillation()">Stop</button>
            <button class="btn-simulate w-full mt-2" onclick="resetOscillation()">Reset</button>
            
            <div class="results-box mt-2">
                <div><strong>Period (T):</strong> <span id="periodResult">1.40</span> s</div>
                <div><strong>Frequency (f):</strong> <span id="frequencyResult">0.71</span> Hz</div>
                <div><strong>Angular Freq (œâ):</strong> <span id="omegaResult">4.47</span> rad/s</div>
                <div><strong>Position:</strong> <span id="positionResult">0.00</span> m</div>
                <div><strong>Velocity:</strong> <span id="velocityResult">0.00</span> m/s</div>
            </div>
        </div>
        
        <!-- Visuals: Canvas + Phase Plot -->
        <div class="concept-card">
            <h3 class="text2xl mb-3">Spring-Mass System & Phase Plot</h3>
            <div class="formula">\( E = K_e + U_s = \frac{1}{2}kx^2+ \frac{1}{2}mv^2=constant (Ê§≠ÂúÜÂõæüòÑ) \)</div>
            <div class="spring-visuals">
                <!-- Spring Canvas -->
                <div style="position: relative;">
                    <canvas id="simulationCanvas" width="360" height="400"></canvas>
                    <div style="position: absolute; top: 10px; left: 10px; font-size: 12px; color: #6b7280; font-weight: bold; background:rgba(255,255,255,0.8); padding:2px 6px; border-radius:4px;">Physical View</div>
                </div>
                
                <!-- Phase Plot Canvas -->
                <div style="position: relative;">
                    <canvas id="phaseCanvas" width="280" height="400"></canvas>
                    <div style="position: absolute; top: 10px; left: 10px; font-size: 12px; color: #6b7280; font-weight: bold; background:rgba(255,255,255,0.8); padding:2px 6px; border-radius:4px;">Phase (x vs v)</div>
                    <!-- Legend -->
                    <div style="position: absolute; top: 35px; right: 10px; font-size: 10px; text-align: right; background:rgba(255,255,255,0.9); padding:4px; border-radius:4px;">
                        <div style="color: #f59e0b; font-weight: bold;">‚óè Above Eq (x < 0)</div>
                        <div style="color: #4f46e5; font-weight: bold;">‚óè Below Eq (x > 0)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Energy Visualization -->
<div class="my-8">
    <h2>Energy Distribution in SHM</h2>
    <div class="concept-card">
        <canvas id="energyCanvas" width="1100" height="250"></canvas>
    </div>
</div>

<!-- Simple Pendulum Simulation -->
<div class="my-8">
    <h2>Simple Pendulum</h2>
    
    <div class="grid-2a">
        <div class="concept-card">
            <h3 class="text2xl mb-3">Pendulum Controls</h3>
            
            <div class="control-group mb-3">
                <label>Length (m): <span id="lengthValue">2.0</span></label>
                <input type="range" id="lengthSlider" min="0.5" max="4" value="2" step="0.1">
            </div>
            
            <div class="control-group mb-3">
                <label>Initial Angle (degrees): <span id="angleValue">20</span></label>
                <input type="range" id="angleSlider" min="5" max="30" value="20" step="5">
            </div>
            
            <button class="btn-simulate w-full" onclick="startPendulum()">Start Pendulum</button>
            <button class="btn-simulate w-full mt-2" onclick="stopPendulum()">Stop</button>
            <button class="btn-simulate w-full mt-2" onclick="resetPendulum()">Reset</button>
            
            <div class="results-box mt-2">
                <div><strong>Period (T):</strong> <span id="pendulumPeriod">2.84</span> s</div>
                <div><strong>Current Angle:</strong> <span id="currentAngle">0.0</span>¬∞</div>
            </div>
        </div>
        
        <div class="concept-card">
            <h3 class="text2xl mb-3">Pendulum Motion</h3>
            <canvas id="pendulumCanvas" width="550" height="400"></canvas>
        </div>
    </div>
</div>

</div>

<script>
// Colors for Phase Plot
const COLOR_ABOVE = '#f59e0b'; // Amber for x < 0
const COLOR_BELOW = '#4f46e5'; // Indigo for x > 0

// === SPRING-MASS SIMULATION ===
const canvas = document.getElementById('simulationCanvas');
const ctx = canvas.getContext('2d');
const phaseCanvas = document.getElementById('phaseCanvas');
const phaseCtx = phaseCanvas.getContext('2d');
const energyCanvas = document.getElementById('energyCanvas');
const energyCtx = energyCanvas.getContext('2d');
const pendulumCanvas = document.getElementById('pendulumCanvas');
const pendulumCtx = pendulumCanvas.getContext('2d');

let mass = 1.0;
let k = 20;
let amplitude = 2.0;
let omega = 0;
let time = 0;
let isOscillating = false;
let animationId = null;

// Store trajectory for phase plot
let phaseTrail = []; 
const MAX_TRAIL_LENGTH = 400;

function updateSpringValues() {
    mass = parseFloat(document.getElementById('massSlider').value);
    k = parseFloat(document.getElementById('springSlider').value);
    amplitude = parseFloat(document.getElementById('amplitudeSlider').value);
    
    document.getElementById('massValue').textContent = mass.toFixed(1);
    document.getElementById('springValue').textContent = k;
    document.getElementById('amplitudeValue').textContent = amplitude.toFixed(1);
    
    calculateSpringProperties();
}

function calculateSpringProperties() {
    omega = Math.sqrt(k / mass);
    const period = 2 * Math.PI / omega;
    const frequency = 1 / period;
    
    document.getElementById('periodResult').textContent = period.toFixed(2);
    document.getElementById('frequencyResult').textContent = frequency.toFixed(2);
    document.getElementById('omegaResult').textContent = omega.toFixed(2);
    
    if (!isOscillating) {
        drawSpring(amplitude, 0);
        drawPhasePlot(amplitude, 0);
        drawEnergyGraph(amplitude, 0);
    }
}

// === ‰ºòÂåñÁöÑÈáëÂ±ûÂÖâÊ≥Ω3DÂºπÁ∞ßÁªòÂà∂ ===
function drawSpring(position, velocity) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    const centerX = canvas.width / 2;
    const wallY = 50;
    const scale = 40;
    const equilibriumY = 200;
    const massY = equilibriumY + position * scale;
    
    // 1. ÁªòÂà∂Âõ∫ÂÆöÂ∫ïÂ∫ß (Ceiling Mount)
    ctx.save();
    ctx.shadowColor = 'rgba(0,0,0,0.2)';
    ctx.shadowBlur = 5;
    ctx.fillStyle = '#374151';
    roundRect(ctx, centerX - 60, wallY - 15, 120, 15, 4);
    ctx.fill();
    ctx.fillStyle = '#9ca3af';
    ctx.beginPath();
    ctx.arc(centerX, wallY, 4, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();

    // 2. ÁªòÂà∂ÈáëÂ±ûÂºπÁ∞ß (Metallic Spring)
    ctx.save();
    const coils = 12; 
    const springRadius = 18; 
    const springLength = massY - wallY - 20; 
    const startY = wallY; 

    // ÈáëÂ±ûÊ∏êÂèò
    const gradient = ctx.createLinearGradient(centerX - springRadius, 0, centerX + springRadius, 0);
    gradient.addColorStop(0, '#4338ca');   
    gradient.addColorStop(0.4, '#a5b4fc'); 
    gradient.addColorStop(0.6, '#a5b4fc'); 
    gradient.addColorStop(1, '#4338ca');   

    ctx.strokeStyle = gradient;
    ctx.lineWidth = 4;
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
    ctx.beginPath();

    ctx.moveTo(centerX, startY);
    ctx.lineTo(centerX, startY + 10);

    const steps = 150; 
    for (let i = 0; i <= steps; i++) {
        const p = i / steps;
        const y = startY + 10 + p * (springLength - 20);
        // Ê≠£Âº¶Ê≥¢Ê®°ÊãüËû∫Êóã
        const x = centerX + Math.sin(p * coils * Math.PI * 2) * springRadius;
        ctx.lineTo(x, y);
    }

    ctx.lineTo(centerX, massY - 25); 
    ctx.stroke();
    ctx.restore();
    
    // 3. ÁªòÂà∂Á´ã‰ΩìÊªëÂùó (The Mass)
    const massSize = 50;
    const boxX = centerX - massSize / 2;
    const boxY = massY - massSize / 2;

    ctx.save();
    ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
    ctx.shadowBlur = 15;
    ctx.shadowOffsetY = 5;

    // ÁêÉ‰ΩìË¥®ÊÑüÊ∏êÂèò
    const massGrad = ctx.createRadialGradient(
        centerX - 10, massY - 10, 5, 
        centerX, massY, massSize
    );
    massGrad.addColorStop(0, '#34d399'); 
    massGrad.addColorStop(1, '#047857'); 

    ctx.fillStyle = massGrad;
    roundRect(ctx, boxX, boxY, massSize, massSize, 8);
    ctx.fill();

    // ÊåÇÈí©
    ctx.shadowBlur = 0; 
    ctx.fillStyle = '#6b7280';
    ctx.fillRect(centerX - 3, boxY - 8, 6, 10);
    
    // Ë¥®Èáè M
    ctx.fillStyle = 'rgba(255,255,255,0.9)';
    ctx.font = 'bold 14px Inter';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('M', centerX, massY);
    ctx.restore();
    
    // 4. Âπ≥Ë°°Á∫ø
    ctx.save();
    ctx.strokeStyle = '#ef4444';
    ctx.setLineDash([4, 4]);
    ctx.globalAlpha = 0.7;
    ctx.beginPath();
    ctx.moveTo(centerX - 120, equilibriumY);
    ctx.lineTo(centerX + 120, equilibriumY);
    ctx.stroke();
    ctx.restore();
}

// === Êñ∞Â¢ûÔºöÁªòÂà∂Áõ∏Âõæ (Phase Plot) ===
function drawPhasePlot(position, velocity) {
    phaseCtx.clearRect(0, 0, phaseCanvas.width, phaseCanvas.height);
    
    const centerX = phaseCanvas.width / 2;
    const centerY = 200; // ‰∏éÂ∑¶‰æßÂºπÁ∞ßÂπ≥Ë°°‰ΩçÁΩÆÈ´òÂ∫¶‰∏ÄËá¥
    const posScale = 40; 
    const velScale = 8; 
    
    // ÂùêÊ†áËΩ¥
    phaseCtx.save();
    phaseCtx.strokeStyle = '#e2e8f0';
    phaseCtx.lineWidth = 1;
    phaseCtx.beginPath(); phaseCtx.moveTo(centerX, 0); phaseCtx.lineTo(centerX, phaseCanvas.height); phaseCtx.stroke();
    phaseCtx.beginPath(); phaseCtx.moveTo(0, centerY); phaseCtx.lineTo(phaseCanvas.width, centerY); phaseCtx.stroke();
    
    // Ê†áÁ≠æ
    phaseCtx.fillStyle = '#94a3b8'; phaseCtx.font = '11px Inter';
    phaseCtx.textAlign = 'right'; phaseCtx.fillText('Velocity ->', phaseCanvas.width - 10, centerY - 5);
    phaseCtx.textAlign = 'left'; phaseCtx.fillText('Position', centerX + 5, 20);
    phaseCtx.restore();

    // Êõ¥Êñ∞ËΩ®Ëøπ
    if (isOscillating) {
        phaseTrail.push({x: velocity, y: position});
        if (phaseTrail.length > MAX_TRAIL_LENGTH) phaseTrail.shift();
    }

    // ÁªòÂà∂ÂèåËâ≤ËΩ®Ëøπ
    if (phaseTrail.length > 1) {
        phaseCtx.save();
        phaseCtx.lineWidth = 2;
        phaseCtx.lineJoin = 'round';
        phaseCtx.lineCap = 'round';

        for (let i = 0; i < phaseTrail.length - 1; i++) {
            const pt1 = phaseTrail[i];
            const pt2 = phaseTrail[i+1];
            
            phaseCtx.beginPath();
            // Ê†∏ÂøÉÈÄªËæëÔºöÂ¶ÇÊûú‰ΩçÁΩÆyÂ∞è‰∫é0ÔºàÂú®Âπ≥Ë°°Á∫ø‰∏äÊñπÔºâÔºåÁî®Áê•ÁèÄËâ≤ÔºõÂê¶ÂàôÁî®ËìùËâ≤
            if (pt1.y < 0) {
                phaseCtx.strokeStyle = COLOR_ABOVE;
            } else {
                phaseCtx.strokeStyle = COLOR_BELOW;
            }
            
            const x1 = centerX + pt1.x * velScale;
            const y1 = centerY + pt1.y * posScale;
            const x2 = centerX + pt2.x * velScale;
            const y2 = centerY + pt2.y * posScale;
            
            phaseCtx.moveTo(x1, y1);
            phaseCtx.lineTo(x2, y2);
            phaseCtx.stroke();
        }
        phaseCtx.restore();
    }

    // ÂΩìÂâçÁÇπ (Dot)
    const currentX = centerX + velocity * velScale;
    const currentY = centerY + position * posScale;

    phaseCtx.save();
    phaseCtx.fillStyle = (position < 0) ? COLOR_ABOVE : COLOR_BELOW;
    phaseCtx.shadowColor = 'rgba(0,0,0,0.2)'; phaseCtx.shadowBlur = 5;
    phaseCtx.beginPath();
    phaseCtx.arc(currentX, currentY, 5, 0, Math.PI * 2);
    phaseCtx.fill();
    
    // ËôöÁ∫øËøûÊé•Âà∞Â∑¶‰æß (Visual alignment)
    phaseCtx.strokeStyle = (position < 0) ? COLOR_ABOVE : COLOR_BELOW;
    phaseCtx.setLineDash([2, 4]);
    phaseCtx.lineWidth = 1;
    phaseCtx.beginPath();
    phaseCtx.moveTo(0, currentY);
    phaseCtx.lineTo(currentX, currentY);
    phaseCtx.stroke();
    phaseCtx.restore();
}

// ËæÖÂä©ÂáΩÊï∞ÔºöÁªòÂà∂ÂúÜËßíÁü©ÂΩ¢
function roundRect(ctx, x, y, width, height, radius) {
    if (height === 0) return;
    ctx.beginPath();
    ctx.moveTo(x + radius, y);
    ctx.lineTo(x + width - radius, y);
    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
    ctx.lineTo(x + width, y + height - radius);
    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
    ctx.lineTo(x + radius, y + height);
    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
    ctx.lineTo(x, y + radius);
    ctx.quadraticCurveTo(x, y, x + radius, y);
    ctx.closePath();
}

function drawEnergyGraph(position, velocity) {
    energyCtx.clearRect(0, 0, energyCanvas.width, energyCanvas.height);
    
    const totalEnergy = 0.5 * k * amplitude * amplitude;
    const pe = 0.5 * k * position * position;
    const ke = 0.5 * mass * velocity * velocity;
    
    const barWidth = 100; // Sligthly smaller to fit
    const maxHeight = 180;
    const w = energyCanvas.width;
    const startX = w/2 - 200; // Center roughly
    const baseY = 220;
    
    // Helper
    const drawBar = (x, val, max, color, label) => {
        const h = (val / max) * maxHeight;
        energyCtx.fillStyle = color;
        roundRect(energyCtx, x, baseY - h, barWidth, h, 4);
        energyCtx.fill();
        energyCtx.fillStyle = '#1f2937';
        energyCtx.font = 'bold 14px Inter';
        energyCtx.textAlign = 'center';
        energyCtx.fillText(label, x + barWidth/2, baseY + 25);
        if(h > 20) {
            energyCtx.fillStyle = 'rgba(255,255,255,0.8)';
            energyCtx.fillText(val.toFixed(1), x + barWidth/2, baseY - h + 20);
        }
    }
    
    drawBar(startX, totalEnergy, totalEnergy, '#6366f1', 'Total E');
    drawBar(startX + 150, pe, totalEnergy, COLOR_ABOVE, 'Pot. (U)');
    drawBar(startX + 300, ke, totalEnergy, '#10b981', 'Kin. (K)');
}

function startOscillation() {
    if (isOscillating) return;
    isOscillating = true;
    time = 0;
    animateSpring();
}

function stopOscillation() {
    isOscillating = false;
    if (animationId) {
        cancelAnimationFrame(animationId);
    }
}

function resetOscillation() {
    stopOscillation();
    time = 0;
    phaseTrail = []; // Reset trail
    drawSpring(amplitude, 0);
    drawPhasePlot(amplitude, 0);
    drawEnergyGraph(amplitude, 0);
    document.getElementById('positionResult').textContent = '0.00';
    document.getElementById('velocityResult').textContent = '0.00';
}

function animateSpring() {
    if (!isOscillating) return;
    
    time += 0.016;
    const position = amplitude * Math.cos(omega * time);
    const velocity = -amplitude * omega * Math.sin(omega * time);
    
    document.getElementById('positionResult').textContent = position.toFixed(2);
    document.getElementById('velocityResult').textContent = velocity.toFixed(2);
    
    drawSpring(position, velocity);
    drawPhasePlot(position, velocity); // Call plot
    drawEnergyGraph(position, velocity);
    
    animationId = requestAnimationFrame(animateSpring);
}

// === PENDULUM SIMULATION ===
let pendulumLength = 2.0;
let pendulumAngle = 20;
let pendulumTheta = 0;
let pendulumOmega = 0;
let pendulumTime = 0;
let isPendulumSwinging = false;
let pendulumAnimationId = null;

function updatePendulumValues() {
    pendulumLength = parseFloat(document.getElementById('lengthSlider').value);
    pendulumAngle = parseFloat(document.getElementById('angleSlider').value);
    
    document.getElementById('lengthValue').textContent = pendulumLength.toFixed(1);
    document.getElementById('angleValue').textContent = pendulumAngle;
    
    const period = 2 * Math.PI * Math.sqrt(pendulumLength / 9.8);
    document.getElementById('pendulumPeriod').textContent = period.toFixed(2);
    
    if (!isPendulumSwinging) {
        drawPendulum(pendulumAngle * Math.PI / 180);
    }
}

function drawPendulum(theta) {
    pendulumCtx.clearRect(0, 0, pendulumCanvas.width, pendulumCanvas.height);
    
    const pivotX = pendulumCanvas.width / 2;
    const pivotY = 50;
    const scale = 80;
    const length = pendulumLength * scale;
    
    const bobX = pivotX + length * Math.sin(theta);
    const bobY = pivotY + length * Math.cos(theta);
    
    // Draw pivot
    pendulumCtx.fillStyle = '#6b7280';
    pendulumCtx.beginPath();
    pendulumCtx.arc(pivotX, pivotY, 8, 0, 2 * Math.PI);
    pendulumCtx.fill();
    
    // Draw string
    pendulumCtx.strokeStyle = '#1f2937';
    pendulumCtx.lineWidth = 2;
    pendulumCtx.beginPath();
    pendulumCtx.moveTo(pivotX, pivotY);
    pendulumCtx.lineTo(bobX, bobY);
    pendulumCtx.stroke();
    
    // Draw bob
    pendulumCtx.fillStyle = '#10b981';
    pendulumCtx.beginPath();
    pendulumCtx.arc(bobX, bobY, 20, 0, 2 * Math.PI);
    pendulumCtx.fill();
    
    // Draw vertical reference
    pendulumCtx.strokeStyle = '#dc2626';
    pendulumCtx.setLineDash([]);
    
    // Draw angle arc
    pendulumCtx.strokeStyle = '#4f46e5';
    pendulumCtx.lineWidth = 2;
    pendulumCtx.beginPath();
    pendulumCtx.arc(pivotX, pivotY, 40, Math.PI/2, Math.PI/2 + theta, theta > 0);
    pendulumCtx.stroke();
    
    // Labels
    pendulumCtx.fillStyle = '#1f2937';
    pendulumCtx.font = '14px Inter';
    const angleDisplay = (theta * 180 / Math.PI).toFixed(1);
    pendulumCtx.fillText(`Œ∏ = ${angleDisplay}¬∞`, pivotX + 50, pivotY + 30);
    pendulumCtx.fillText(`L = ${pendulumLength.toFixed(1)}m`, bobX + 25, bobY);
}

function startPendulum() {
    if (isPendulumSwinging) return;
    isPendulumSwinging = true;
    pendulumTheta = pendulumAngle * Math.PI / 180;
    pendulumOmega = 0;
    pendulumTime = 0;
    animatePendulum();
}

function stopPendulum() {
    isPendulumSwinging = false;
    if (pendulumAnimationId) {
        cancelAnimationFrame(pendulumAnimationId);
    }
}

function resetPendulum() {
    stopPendulum();
    pendulumTheta = pendulumAngle * Math.PI / 180;
    pendulumOmega = 0;
    drawPendulum(pendulumTheta);
    document.getElementById('currentAngle').textContent = pendulumAngle.toFixed(1);
}

function animatePendulum() {
    if (!isPendulumSwinging) return;
    
    const dt = 0.016;
    const g = 9.8;
    
    // Small angle approximation: angular acceleration = -(g/L) * theta
    const alpha = -(g / pendulumLength) * Math.sin(pendulumTheta);
    pendulumOmega += alpha * dt;
    pendulumTheta += pendulumOmega * dt;
    
    document.getElementById('currentAngle').textContent = (pendulumTheta * 180 / Math.PI).toFixed(1);
    
    drawPendulum(pendulumTheta);
    
    pendulumAnimationId = requestAnimationFrame(animatePendulum);
}

// Event listeners
document.getElementById('massSlider').addEventListener('input', updateSpringValues);
document.getElementById('springSlider').addEventListener('input', updateSpringValues);
document.getElementById('amplitudeSlider').addEventListener('input', updateSpringValues);
document.getElementById('lengthSlider').addEventListener('input', updatePendulumValues);
document.getElementById('angleSlider').addEventListener('input', updatePendulumValues);

// Initialize
window.onload = function() {
    updateSpringValues();
    updatePendulumValues();
};
</script>

</body>
</html>
